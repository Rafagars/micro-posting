{% extends 'base.html' %}
{% block title %} Home {% endblock %}
{% block content %}

{% if message %}
<div class="alert alert-primary" role="alert">
	{{ message }}
 </div>
{% endif %}

{% if current_user.is_authenticated %}
<div class="text-center">
	<a href="{{url_for('new_post')}}" class="btn btn-primary"> New Post</a>
</div>

<div>
			
{% for post in posts %}
	<br>
	<div class="post col-lg-10 col-12 mx-auto ">
		<div class="float-right">
			{% if current_user.id == post.posted_by or current_user.admin %}
			<a href="{{url_for('edit_post', post_id = post.id)}}" class="fas fa-edit"></a>
			<a href="{{url_for('delete_post', post_id = post.id)}}" class="fas fa-trash"></a>
			{% endif %}
		</div>
		<h2 class=""><a href="{{ post.public_url() }}">{{post.title}}</a></h2>
		
		<div class="">
			<p>{{post.body|safe}}</p>
		</div>

		<div class="">
			{% if current_user.has_liked(post) %}
			<a href="{{ url_for('like_action', post_id=post.id, action='unlike') }}" class="unlike fas fa-heart"></a><span>{{ post.likes.count() }}</span>
			{% else %}
			<a href="{{ url_for('like_action', post_id=post.id, action='like') }}" class="like far fa-heart"></a><span>{{ post.likes.count() }}</span>
			{% endif %}
			<a href="{{ post.public_url() }}" class="far fa-comment"></a><span>{{ post.comments.count() }} </span>
		</div>
		
		<p>
			<small> Posted by: <a href="{{url_for('show_user', username = post.username)}}">{{ post.username }}</a> <span> Created {{ moment(post.created).fromNow() }}  </span></small>
			
		</p>
	</div>
				
{% endfor %}

	<nav aria-label="Page navigation">
		<ul class="pagination">
		{% if prev_url %}
    	<li class="page-item"><a class="page-link" href="{{ prev_url }}">Newer posts</a></li>
    	{% endif %}
    	{% if next_url %}
    	<li class="page-item"><a class="page-link" href="{{ next_url }}">Older posts</a></li>
    	{% endif %}
		</ul>
	</nav>

</div>

{% else %}
	<div class="jumbotron">
		<h1 class="text-center">Welcome to Micro-Posting</h1>
		<a href="{{url_for('signup')}}" class="btn btn-lg btn-primary offset-5"> Sign Up</a>
	</div>
{% endif %}
{% endblock %}